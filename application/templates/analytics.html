{% extends 'base.html' %}

{% block content %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
       <!-- Div for Plotly Chart -->
        <h1>Livestock Average Speed</h1>
 
       <div id="speedChart"></div>
       

    <script>
        // Dummy data for livestock speeds
        const livestockData = [
            { name: 'Cow 1', type: 'cow', speed: 4.5 },
            { name: 'Cow 2', type: 'cow', speed: 5.0 },
            { name: 'Sheep 1', type: 'sheep', speed: 6.5 },
            { name: 'Sheep 2', type: 'sheep', speed: 6.2 },
            { name: 'Goat 1', type: 'goat', speed: 7.0 },
            { name: 'Horse 1', type: 'horse', speed: 60.0 },
            { name: 'Horse 2', type: 'horse', speed: 55.0 },
        ];

        // Helper function to add small random jitter to x-values
        function addJitter(baseX, jitterAmount = 0.1) {
            return baseX + (Math.random() * jitterAmount - jitterAmount / 2);
        }

        // Generate x-values with slight jitter for each animal type
        const getXValues = (animalType, count) => Array.from({ length: count }, () => addJitter(types.indexOf(animalType) + 1));

        // Define animal types in the order they should appear
        const types = ['cow', 'sheep', 'goat', 'horse'];

        const traceCows = {
            x: getXValues('cow', livestockData.filter(animal => animal.type === 'cow').length),
            y: livestockData.filter(animal => animal.type === 'cow').map(animal => animal.speed),
            mode: 'markers',
            name: 'Cows',
            marker: {
                color: 'rgb(164, 194, 244)',
                size: 12,
                line: {
                    color: 'white',
                    width: 0.5
                }
            },
            text: livestockData.filter(animal => animal.type === 'cow').map(animal => animal.name + ' (' + animal.speed + ' km/h)'),
            hoverinfo: 'text',
            type: 'scatter'
        };

        const traceSheep = {
            x: getXValues('sheep', livestockData.filter(animal => animal.type === 'sheep').length),
            y: livestockData.filter(animal => animal.type === 'sheep').map(animal => animal.speed),
            mode: 'markers',
            name: 'Sheep',
            marker: {
                color: 'rgb(255, 217, 102)',
                size: 12
            },
            text: livestockData.filter(animal => animal.type === 'sheep').map(animal => animal.name + ' (' + animal.speed + ' km/h)'),
            hoverinfo: 'text',
            type: 'scatter'
        };

        const traceGoats = {
            x: getXValues('goat', livestockData.filter(animal => animal.type === 'goat').length),
            y: livestockData.filter(animal => animal.type === 'goat').map(animal => animal.speed),
            mode: 'markers',
            name: 'Goats',
            marker: {
                color: 'rgb(234, 153, 153)',
                size: 12
            },
            text: livestockData.filter(animal => animal.type === 'goat').map(animal => animal.name + ' (' + animal.speed + ' km/h)'),
            hoverinfo: 'text',
            type: 'scatter'
        };

        const traceHorses = {
            x: getXValues('horse', livestockData.filter(animal => animal.type === 'horse').length),
            y: livestockData.filter(animal => animal.type === 'horse').map(animal => animal.speed),
            mode: 'markers',
            name: 'Horses',
            marker: {
                color: 'rgb(142, 124, 195)',
                size: 12
            },
            text: livestockData.filter(animal => animal.type === 'horse').map(animal => animal.name + ' (' + animal.speed + ' km/h)'),
            hoverinfo: 'text',
            type: 'scatter'
        };

        // Combine traces into data array
        const data = [traceCows, traceSheep, traceGoats, traceHorses];

        // Layout for the plot
        const layout = {
            title: 'Livestock Speed by Type',
            xaxis: {
                title: 'Animal Type',
                showgrid: false,
                zeroline: false,
                tickvals: [1, 2, 3, 4], // Positions of types on x-axis
                ticktext: ['Cows', 'Sheep', 'Goats', 'Horses'], // Displayed labels
                range: [0.5, 4.5] // Make space for jittered points
            },
            yaxis: {
                title: 'Speed (km/h)',
                showline: false,
                range: [0, 70] // Define a y-axis range based on expected max speed
            }
        };

        // Render the plot
        Plotly.newPlot('speedChart', data, layout);
    </script>
{% endblock %}
